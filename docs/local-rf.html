<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Interpretability &amp; Explainability with Random Forest | Advanced Geospatial Data Analysis with R – Applications in Geosciences</title>
  <meta name="description" content="Chapter 6 Interpretability &amp; Explainability with Random Forest | Advanced Geospatial Data Analysis with R – Applications in Geosciences" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Interpretability &amp; Explainability with Random Forest | Advanced Geospatial Data Analysis with R – Applications in Geosciences" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Interpretability &amp; Explainability with Random Forest | Advanced Geospatial Data Analysis with R – Applications in Geosciences" />
  
  
  

<meta name="author" content="Dr. Marj Tonini, Haokun Liu" />


<meta name="date" content="2024-09-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="global-rf.html"/>
<link rel="next" href="som.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/AGDA_ImageCover.webp"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-overview"><i class="fa fa-check"></i>Book overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#computing-lab"><i class="fa fa-check"></i>Computing lab</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#target-audience"><i class="fa fa-check"></i>Target audience</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#authors-information"><i class="fa fa-check"></i>Authors information</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#my-journey-of-learning-integrating-geospatial-data-analysis-with-data-science"><i class="fa fa-check"></i>My Journey of Learning: Integrating Geospatial Data Analysis with Data Science</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#r-language"><i class="fa fa-check"></i><b>1.1</b> R Language</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#r-packages"><i class="fa fa-check"></i><b>1.1.1</b> R Packages</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#some-tips"><i class="fa fa-check"></i><b>1.1.2</b> Some tips</a></li>
<li class="chapter" data-level="1.1.3" data-path="intro.html"><a href="intro.html#r-commands-online-resources"><i class="fa fa-check"></i><b>1.1.3</b> R Commands (online resources)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#r-markdown"><i class="fa fa-check"></i><b>1.2</b> R Markdown</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#data-type-in-computational-analysis"><i class="fa fa-check"></i><b>1.3</b> Data type in computational analysis</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#variables"><i class="fa fa-check"></i><b>1.3.1</b> Variables</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#data-structure-in-r"><i class="fa fa-check"></i><b>1.3.2</b> Data structure in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="geodata.html"><a href="geodata.html"><i class="fa fa-check"></i><b>2</b> Basic operations with geodata in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="geodata.html"><a href="geodata.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="geodata.html"><a href="geodata.html#plotting-vector-dataset"><i class="fa fa-check"></i><b>2.2</b> Plotting vector dataset</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="geodata.html"><a href="geodata.html#package-sf-for-vector-dataset"><i class="fa fa-check"></i><b>2.2.1</b> Package <strong><em>sf</em></strong> for vector dataset</a></li>
<li class="chapter" data-level="2.2.2" data-path="geodata.html"><a href="geodata.html#plot-vector-features"><i class="fa fa-check"></i><b>2.2.2</b> Plot vector features</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="geodata.html"><a href="geodata.html#plotting-raster-dataset"><i class="fa fa-check"></i><b>2.3</b> Plotting raster dataset</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="geodata.html"><a href="geodata.html#terra-package-and-raster-dataset"><i class="fa fa-check"></i><b>2.3.1</b> Terra package and raster dataset</a></li>
<li class="chapter" data-level="2.3.2" data-path="geodata.html"><a href="geodata.html#plot-raster-features"><i class="fa fa-check"></i><b>2.3.2</b> Plot raster features</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="geodata.html"><a href="geodata.html#geodata-manipulation"><i class="fa fa-check"></i><b>2.4</b> Geodata manipulation</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="geodata.html"><a href="geodata.html#manipulate-tabular-datasets"><i class="fa fa-check"></i><b>2.4.1</b> Manipulate tabular datasets</a></li>
<li class="chapter" data-level="2.4.2" data-path="geodata.html"><a href="geodata.html#pipes-chaining-of-multiple-operations"><i class="fa fa-check"></i><b>2.4.2</b> Pipes: chaining of multiple operations</a></li>
<li class="chapter" data-level="2.4.3" data-path="geodata.html"><a href="geodata.html#join-table"><i class="fa fa-check"></i><b>2.4.3</b> Join table</a></li>
<li class="chapter" data-level="2.4.4" data-path="geodata.html"><a href="geodata.html#mapping-with-ggplot2"><i class="fa fa-check"></i><b>2.4.4</b> Mapping with ggplot2</a></li>
<li class="chapter" data-level="2.4.5" data-path="geodata.html"><a href="geodata.html#cropping-ratser"><i class="fa fa-check"></i><b>2.4.5</b> Cropping ratser</a></li>
<li class="chapter" data-level="2.4.6" data-path="geodata.html"><a href="geodata.html#display-the-categorical-variables-of-a-raster"><i class="fa fa-check"></i><b>2.4.6</b> Display the categorical variables of a raster</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="geodata.html"><a href="geodata.html#further-reading"><i class="fa fa-check"></i><b>2.5</b> Further Reading</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gwss.html"><a href="gwss.html"><i class="fa fa-check"></i><b>3</b> Geographically Weighted Summary Statistics for Geosciences</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gwss.html"><a href="gwss.html#gwss-for-natural-hazards-assessment"><i class="fa fa-check"></i><b>3.1</b> GWSS for natural hazards assessment</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="gwss.html"><a href="gwss.html#the-overall-methodology"><i class="fa fa-check"></i><b>3.1.1</b> The overall methodology</a></li>
<li class="chapter" data-level="3.1.2" data-path="gwss.html"><a href="gwss.html#forest-fires-dataset"><i class="fa fa-check"></i><b>3.1.2</b> Forest fires dataset</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="gwss.html"><a href="gwss.html#computing-lab-gwss"><i class="fa fa-check"></i><b>3.2</b> Computing lab: GWSS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="gwss.html"><a href="gwss.html#load-the-libraries"><i class="fa fa-check"></i><b>3.2.1</b> Load the libraries</a></li>
<li class="chapter" data-level="3.2.2" data-path="gwss.html"><a href="gwss.html#import-the-forest-fire-dataset"><i class="fa fa-check"></i><b>3.2.2</b> Import the forest fire dataset</a></li>
<li class="chapter" data-level="3.2.3" data-path="gwss.html"><a href="gwss.html#forest-fires-spatial-distribution"><i class="fa fa-check"></i><b>3.2.3</b> Forest fires spatial distribution</a></li>
<li class="chapter" data-level="3.2.4" data-path="gwss.html"><a href="gwss.html#compute-the-gwss"><i class="fa fa-check"></i><b>3.2.4</b> Compute the GWSS</a></li>
<li class="chapter" data-level="3.2.5" data-path="gwss.html"><a href="gwss.html#look-at-the-results"><i class="fa fa-check"></i><b>3.2.5</b> Look at the results</a></li>
<li class="chapter" data-level="3.2.6" data-path="gwss.html"><a href="gwss.html#gwss-maps"><i class="fa fa-check"></i><b>3.2.6</b> GWSS maps</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="gwss.html"><a href="gwss.html#conclusions-and-further-analyses"><i class="fa fa-check"></i><b>3.3</b> Conclusions and further analyses</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="kde.html"><a href="kde.html"><i class="fa fa-check"></i><b>4</b> Spatio-Temporal Cluster Analysis of GeoEnvironmental Processes</a>
<ul>
<li class="chapter" data-level="4.1" data-path="kde.html"><a href="kde.html#st-clustering-for-fire-management"><i class="fa fa-check"></i><b>4.1</b> ST clustering for fire management</a></li>
<li class="chapter" data-level="4.2" data-path="kde.html"><a href="kde.html#clustering-methods"><i class="fa fa-check"></i><b>4.2</b> Clustering methods</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="kde.html"><a href="kde.html#ripleys-k-function"><i class="fa fa-check"></i><b>4.2.1</b> Ripley’s K-function</a></li>
<li class="chapter" data-level="4.2.2" data-path="kde.html"><a href="kde.html#kernel-density-estimator"><i class="fa fa-check"></i><b>4.2.2</b> Kernel density estimator</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="kde.html"><a href="kde.html#computing-lab-st-clustering"><i class="fa fa-check"></i><b>4.3</b> Computing lab: ST clustering</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="kde.html"><a href="kde.html#load-the-libraries-1"><i class="fa fa-check"></i><b>4.3.1</b> Load the libraries</a></li>
<li class="chapter" data-level="4.3.2" data-path="kde.html"><a href="kde.html#import-the-forest-fire-dataset-1"><i class="fa fa-check"></i><b>4.3.2</b> Import the forest fire dataset</a></li>
<li class="chapter" data-level="4.3.3" data-path="kde.html"><a href="kde.html#forest-fires-subsets-based-on-the-size-of-the-burned-area"><i class="fa fa-check"></i><b>4.3.3</b> Forest fires subsets based on the size of the burned area</a></li>
<li class="chapter" data-level="4.3.4" data-path="kde.html"><a href="kde.html#ff-subsets-based-on-their-geographical-distribution"><i class="fa fa-check"></i><b>4.3.4</b> FF-subsets based on their geographical distribution</a></li>
<li class="chapter" data-level="4.3.5" data-path="kde.html"><a href="kde.html#extract-time-and-pts-object"><i class="fa fa-check"></i><b>4.3.5</b> Extract time and PTS object</a></li>
<li class="chapter" data-level="4.3.6" data-path="kde.html"><a href="kde.html#compute-the-st-k-function"><i class="fa fa-check"></i><b>4.3.6</b> Compute the ST K-function</a></li>
<li class="chapter" data-level="4.3.7" data-path="kde.html"><a href="kde.html#assess-the-st-clustering-behavior"><i class="fa fa-check"></i><b>4.3.7</b> Assess the ST clustering behavior</a></li>
<li class="chapter" data-level="4.3.8" data-path="kde.html"><a href="kde.html#compute-the-st-kernel-density-estimator"><i class="fa fa-check"></i><b>4.3.8</b> Compute the ST Kernel Density Estimator</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="kde.html"><a href="kde.html#conclusions-and-further-analyses-1"><i class="fa fa-check"></i><b>4.4</b> Conclusions and further analyses</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="global-rf.html"><a href="global-rf.html"><i class="fa fa-check"></i><b>5</b> Predictive Mapping of Natural Hazards Using Random Forest</a>
<ul>
<li class="chapter" data-level="5.1" data-path="global-rf.html"><a href="global-rf.html#rf-for-landslides-susceptibility-mapping"><i class="fa fa-check"></i><b>5.1</b> RF for landslides susceptibility mapping</a></li>
<li class="chapter" data-level="5.2" data-path="global-rf.html"><a href="global-rf.html#computing-lab-random-forest"><i class="fa fa-check"></i><b>5.2</b> Computing lab: Random Forest</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="global-rf.html"><a href="global-rf.html#load-the-libraries-2"><i class="fa fa-check"></i><b>5.2.1</b> Load the libraries</a></li>
<li class="chapter" data-level="5.2.2" data-path="global-rf.html"><a href="global-rf.html#load-the-input-datasets"><i class="fa fa-check"></i><b>5.2.2</b> Load the input datasets</a></li>
<li class="chapter" data-level="5.2.3" data-path="global-rf.html"><a href="global-rf.html#the-use-of-categorical-variables-in-machine-learning"><i class="fa fa-check"></i><b>5.2.3</b> The use of categorical variables in Machine Learning</a></li>
<li class="chapter" data-level="5.2.4" data-path="global-rf.html"><a href="global-rf.html#extract-the-values"><i class="fa fa-check"></i><b>5.2.4</b> Extract the values</a></li>
<li class="chapter" data-level="5.2.5" data-path="global-rf.html"><a href="global-rf.html#split-the-input-dataset-into-training-and-testing"><i class="fa fa-check"></i><b>5.2.5</b> Split the input dataset into training and testing</a></li>
<li class="chapter" data-level="5.2.6" data-path="global-rf.html"><a href="global-rf.html#run-random-forest"><i class="fa fa-check"></i><b>5.2.6</b> Run Random Forest</a></li>
<li class="chapter" data-level="5.2.7" data-path="global-rf.html"><a href="global-rf.html#rf-main-outputs"><i class="fa fa-check"></i><b>5.2.7</b> RF main outputs</a></li>
<li class="chapter" data-level="5.2.8" data-path="global-rf.html"><a href="global-rf.html#model-evaluation"><i class="fa fa-check"></i><b>5.2.8</b> Model evaluation</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="global-rf.html"><a href="global-rf.html#susceptibility-mapping"><i class="fa fa-check"></i><b>5.3</b> Susceptibility mapping</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="global-rf.html"><a href="global-rf.html#class-intervals-for-decision-maker"><i class="fa fa-check"></i><b>5.3.1</b> Class intervals for decision maker</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="global-rf.html"><a href="global-rf.html#conclusions-and-further-analyses-2"><i class="fa fa-check"></i><b>5.4</b> Conclusions and further analyses</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="local-rf.html"><a href="local-rf.html"><i class="fa fa-check"></i><b>6</b> Interpretability &amp; Explainability with Random Forest</a>
<ul>
<li class="chapter" data-level="6.1" data-path="local-rf.html"><a href="local-rf.html#aim-of-the-present-lab"><i class="fa fa-check"></i><b>6.1</b> Aim of the present lab</a></li>
<li class="chapter" data-level="6.2" data-path="local-rf.html"><a href="local-rf.html#computing-lab-understanding-random-forest-models"><i class="fa fa-check"></i><b>6.2</b> Computing lab: Understanding Random Forest Models</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="local-rf.html"><a href="local-rf.html#re-load-libraries-and-workspace"><i class="fa fa-check"></i><b>6.2.1</b> Re-load libraries and workspace</a></li>
<li class="chapter" data-level="6.2.2" data-path="local-rf.html"><a href="local-rf.html#surrogate-model"><i class="fa fa-check"></i><b>6.2.2</b> Surrogate model</a></li>
<li class="chapter" data-level="6.2.3" data-path="local-rf.html"><a href="local-rf.html#features-importance-score"><i class="fa fa-check"></i><b>6.2.3</b> Features importance score</a></li>
<li class="chapter" data-level="6.2.4" data-path="local-rf.html"><a href="local-rf.html#partial-dependence-plot"><i class="fa fa-check"></i><b>6.2.4</b> Partial dependence plot</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="local-rf.html"><a href="local-rf.html#local-feature-importance"><i class="fa fa-check"></i><b>6.3</b> Local feature importance</a></li>
<li class="chapter" data-level="6.4" data-path="local-rf.html"><a href="local-rf.html#computing-lab-geographical-random-forest"><i class="fa fa-check"></i><b>6.4</b> Computing lab: Geographical Random Forest</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="local-rf.html"><a href="local-rf.html#global-variable-importance-plot"><i class="fa fa-check"></i><b>6.4.1</b> Global variable importance plot</a></li>
<li class="chapter" data-level="6.4.2" data-path="local-rf.html"><a href="local-rf.html#local-feature-importance-mapping"><i class="fa fa-check"></i><b>6.4.2</b> Local feature importance mapping</a></li>
<li class="chapter" data-level="6.4.3" data-path="local-rf.html"><a href="local-rf.html#local-r-squared"><i class="fa fa-check"></i><b>6.4.3</b> Local R squared</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="local-rf.html"><a href="local-rf.html#conclusions-and-further-analyses-3"><i class="fa fa-check"></i><b>6.5</b> Conclusions and further analyses</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="som.html"><a href="som.html"><i class="fa fa-check"></i><b>7</b> Defining Territorial Typologies Using Unsupervised Learning: A SOM Approach</a>
<ul>
<li class="chapter" data-level="7.1" data-path="som.html"><a href="som.html#geo-demographic-context-in-switzerland"><i class="fa fa-check"></i><b>7.1</b> Geo-demographic context in Switzerland</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="som.html"><a href="som.html#swiss-census-data"><i class="fa fa-check"></i><b>7.1.1</b> Swiss census data</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="som.html"><a href="som.html#self-organizing-map"><i class="fa fa-check"></i><b>7.2</b> Self Organizing Map</a></li>
<li class="chapter" data-level="7.3" data-path="som.html"><a href="som.html#computing-lab-som"><i class="fa fa-check"></i><b>7.3</b> Computing lab: SOM</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="som.html"><a href="som.html#load-the-libraries-3"><i class="fa fa-check"></i><b>7.3.1</b> Load the libraries</a></li>
<li class="chapter" data-level="7.3.2" data-path="som.html"><a href="som.html#import-the-swiss-census-dataset"><i class="fa fa-check"></i><b>7.3.2</b> Import the Swiss census dataset</a></li>
<li class="chapter" data-level="7.3.3" data-path="som.html"><a href="som.html#run-som"><i class="fa fa-check"></i><b>7.3.3</b> Run SOM</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="som.html"><a href="som.html#hierarchical-clustering"><i class="fa fa-check"></i><b>7.4</b> Hierarchical clustering</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="som.html"><a href="som.html#map-clusters-onto-the-geographical-space"><i class="fa fa-check"></i><b>7.4.1</b> <strong>Map clusters onto the geographical space</strong></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="som.html"><a href="som.html#clusters-characterization"><i class="fa fa-check"></i><b>7.5</b> Clusters characterization</a></li>
<li class="chapter" data-level="7.6" data-path="som.html"><a href="som.html#conclusions"><i class="fa fa-check"></i><b>7.6</b> Conclusions</a></li>
<li class="chapter" data-level="7.7" data-path="som.html"><a href="som.html#further-analyses"><i class="fa fa-check"></i><b>7.7</b> Further analyses</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dbscan.html"><a href="dbscan.html"><i class="fa fa-check"></i><b>8</b> DBSCAN for 3D features detection in geosciences</a>
<ul>
<li class="chapter" data-level="8.1" data-path="dbscan.html"><a href="dbscan.html#the-overall-methodology-1"><i class="fa fa-check"></i><b>8.1</b> The overall methodology</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="dbscan.html"><a href="dbscan.html#dbscan-3-d-density-based-clustering-algorithm"><i class="fa fa-check"></i><b>8.1.1</b> DBSCAN: 3-D density based clustering algorithm</a></li>
<li class="chapter" data-level="8.1.2" data-path="dbscan.html"><a href="dbscan.html#field-campaign"><i class="fa fa-check"></i><b>8.1.2</b> Field campaign</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dbscan.html"><a href="dbscan.html#computing-lab-dbscan"><i class="fa fa-check"></i><b>8.2</b> Computing lab: DBSCAN</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="dbscan.html"><a href="dbscan.html#load-the-libraries-4"><i class="fa fa-check"></i><b>8.2.1</b> Load the libraries</a></li>
<li class="chapter" data-level="8.2.2" data-path="dbscan.html"><a href="dbscan.html#import-and-visualize-the-point-clouds-dataset"><i class="fa fa-check"></i><b>8.2.2</b> Import and visualize the point clouds dataset</a></li>
<li class="chapter" data-level="8.2.3" data-path="dbscan.html"><a href="dbscan.html#compute-dbscan"><i class="fa fa-check"></i><b>8.2.3</b> Compute DBSCAN</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="dbscan.html"><a href="dbscan.html#conclusions-and-further-analyses-4"><i class="fa fa-check"></i><b>8.3</b> Conclusions and further analyses</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Geospatial Data Analysis with R – Applications in Geosciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="local-rf" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Interpretability &amp; Explainability with Random Forest<a href="local-rf.html#local-rf" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the world of machine learning, interpretability and explainability are two therms commonly used to describe the extent to which an algorithm’s behavior can be understood.
The distinction between them lies in their focus and depth.
We can say that interpretability focuses on understanding the inner workings of the models, while explainability focuses on explaining the decisions made.
Define if an algorithm is interpretable or explainable depend on different factors as described below.</p>
<p><strong>Model complexity</strong> – When dealing with intricate models like Random Forest (with tens of variables and thousands of trees), up to deep neural networks, interpretability becomes challenging due to their complexity and the interplay among their components.
In such scenarios, explainability proves to be a more practical approach, as it focuses on clarifying decisions rather than delving into the complexities of the algorithm.</p>
<p><strong>Communication</strong> – In terms of audience and purpose, interpretability primarily concerns machine learning specialists , whereas explainability targets end users seeking to grasp model decisions.
Consequently, explainability necessitates a more straightforward and intuitive communication of information.</p>
<p>While Random Forest (RF) is a powerful algorithm and often yield high accuracy, interpretability can be challenging due to its complex structure and the high number of tress.
However, the following techniques can enhance the interpretability and explainability of RF models.</p>
<ul>
<li><p><strong>Interpretability</strong> – A <em>surrogate model</em>, such as a single decision tree, can approximate the predictions of a more complex model like a RF, which is composed of thousands of decision trees.
The surrogate model is more interpretable and helps in understanding the general rules that RF tipically follows.</p></li>
<li><p><strong>Explainability</strong> – Examining <em>feature importance scores</em>, which measure the contribution of each variable to the model’s predictions, allows us to identify the most influential variables in the model’s decisions.
In addition, <em>partial dependence plots</em> enable us to visualize how changes in a variable influence the model’s predictions, making this tool useful for interpreting the global effects of predictors across the entire dataset.</p></li>
</ul>
<div id="aim-of-the-present-lab" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Aim of the present lab<a href="local-rf.html#aim-of-the-present-lab" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this computing lab you will work with the outputs of RF resulting from the previous lab on landslides susceptibility map.</p>
<ul>
<li><p>Firstly, we will explore the relative importance of the predictor variables (feature importance scores) , and their relative probability of prediction success (partial dependence plots).
These are the core of explainability in RF.</p></li>
<li><p>In the second part, we will apply a local version of RF (named “<em>Geographical Random Forest</em>”) to analyse the spatial heterogeneity of the local variable importance.
This will help to deep our understanding of the influence of the predictor variable explored locally,</p></li>
</ul>
</div>
<div id="computing-lab-understanding-random-forest-models" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Computing lab: Understanding Random Forest Models<a href="local-rf.html#computing-lab-understanding-random-forest-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="re-load-libraries-and-workspace" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Re-load libraries and workspace<a href="local-rf.html#re-load-libraries-and-workspace" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you have quit the workspace where you have run the RF model for landslide susceptibility mapping, you need to load it again in this new project.
Loading the workspace refers to the action of restoring the saved state of R environment.
When you save your workspace in R, it typically includes all the objects (such as variables, functions, data frames, etc.) that are currently present in your R session.
Loading the workspace means to restore this saved state, bringing back all the previously saved objects into your current R session.</p>
<pre><code>##  [1] &quot;RColorBrewer&quot; &quot;tidyr&quot;        &quot;randomForest&quot; &quot;classInt&quot;     &quot;plotROC&quot;     
##  [6] &quot;ggplot2&quot;      &quot;pROC&quot;         &quot;dplyr&quot;        &quot;readr&quot;        &quot;foreign&quot;     
## [11] &quot;terra&quot;        &quot;stats&quot;        &quot;graphics&quot;     &quot;grDevices&quot;    &quot;utils&quot;       
## [16] &quot;datasets&quot;     &quot;methods&quot;      &quot;base&quot;</code></pre>
</div>
<div id="surrogate-model" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Surrogate model<a href="local-rf.html#surrogate-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Although machine learning algorithms are often considered as a black box, with RF is possible to plot a sample tree (selected randomly) to analyse its structure and investigate how decisions have been made.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="local-rf.html#cb164-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;party&quot;</span>)</span>
<span id="cb164-2"><a href="local-rf.html#cb164-2" tabindex="-1"></a></span>
<span id="cb164-3"><a href="local-rf.html#cb164-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ctree</span>(LS<span class="sc">~</span>., <span class="at">data=</span>LS_train)</span>
<span id="cb164-4"><a href="local-rf.html#cb164-4" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="at">type=</span><span class="st">&quot;simple&quot;</span>)</span></code></pre></div>
</div>
<div id="features-importance-score" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Features importance score<a href="local-rf.html#features-importance-score" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RF provides two scores allowing to assess the importance of each variables in the model: the Mean Decrease in Accuracy (MDA), and the mean decrease in Gini index.
The MDA indicates how much the tree nodes that use a given variable enable reducing the mean-square errors evaluated on the Out-Of-Bag and across all the trees.
The Gini index measures the probability of incorrectly classifying a randomly chosen element in a dataset if that element were classified based on the distribution of classes in a particular node.
The relative importance of the predictor variables can be ranked based on the increasing values of both these scores: the higher the value, the more important the variable.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="local-rf.html#cb165-1" tabindex="-1"></a><span class="co"># Display the plot with the relative importance of each variable</span></span>
<span id="cb165-2"><a href="local-rf.html#cb165-2" tabindex="-1"></a><span class="fu">importance</span>(RF_LS)</span>
<span id="cb165-3"><a href="local-rf.html#cb165-3" tabindex="-1"></a><span class="fu">varImpPlot</span>(RF_LS)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/var-imp-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="partial-dependence-plot" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> Partial dependence plot<a href="local-rf.html#partial-dependence-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Partial Dependence Plot (PDP) allows us to estimate, for each single variable, the relative probability of prediction success over different ranges of values.
PDP provides a graphical depiction of the marginal effect of each variable on the class probability over different ranges of continuous or discrete values.
Positive values are associated with the probability of occurrence of the phenomena (i.e., landslides presence), while negative vales indicate its absence.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="local-rf.html#cb166-1" tabindex="-1"></a><span class="co">#Compute PDP for all the predictor variables </span></span>
<span id="cb166-2"><a href="local-rf.html#cb166-2" tabindex="-1"></a></span>
<span id="cb166-3"><a href="local-rf.html#cb166-3" tabindex="-1"></a><span class="co"># Slope</span></span>
<span id="cb166-4"><a href="local-rf.html#cb166-4" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> slope, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb166-5"><a href="local-rf.html#cb166-5" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Slope [Â°]&quot;</span>, </span>
<span id="cb166-6"><a href="local-rf.html#cb166-6" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="local-rf.html#cb167-1" tabindex="-1"></a><span class="co"># Elevation</span></span>
<span id="cb167-2"><a href="local-rf.html#cb167-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train ,<span class="at">x.var =</span> DEM, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb167-3"><a href="local-rf.html#cb167-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Elevation [m]&quot;</span>, </span>
<span id="cb167-4"><a href="local-rf.html#cb167-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="local-rf.html#cb168-1" tabindex="-1"></a><span class="co"># Profile curvature</span></span>
<span id="cb168-2"><a href="local-rf.html#cb168-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> profCurv, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb168-3"><a href="local-rf.html#cb168-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Profile curvature [1/m]&quot;</span>, </span>
<span id="cb168-4"><a href="local-rf.html#cb168-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="local-rf.html#cb169-1" tabindex="-1"></a><span class="co"># Plan Curvature</span></span>
<span id="cb169-2"><a href="local-rf.html#cb169-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> planCurv, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb169-3"><a href="local-rf.html#cb169-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Plan curvature [1/m]&quot;</span>, </span>
<span id="cb169-4"><a href="local-rf.html#cb169-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="local-rf.html#cb170-1" tabindex="-1"></a><span class="co"># Distance to road</span></span>
<span id="cb170-2"><a href="local-rf.html#cb170-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> distRoad, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb170-3"><a href="local-rf.html#cb170-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Distance to road [m]&quot;</span>, </span>
<span id="cb170-4"><a href="local-rf.html#cb170-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-5.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="local-rf.html#cb171-1" tabindex="-1"></a><span class="co"># Topographic wetness index</span></span>
<span id="cb171-2"><a href="local-rf.html#cb171-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> TWI, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb171-3"><a href="local-rf.html#cb171-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;TWI [-]&quot;</span>, </span>
<span id="cb171-4"><a href="local-rf.html#cb171-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-6.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="local-rf.html#cb172-1" tabindex="-1"></a><span class="co"># Geology</span></span>
<span id="cb172-2"><a href="local-rf.html#cb172-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> geology, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb172-3"><a href="local-rf.html#cb172-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Geology&quot;</span>, </span>
<span id="cb172-4"><a href="local-rf.html#cb172-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-7.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="local-rf.html#cb173-1" tabindex="-1"></a><span class="co"># Land cover</span></span>
<span id="cb173-2"><a href="local-rf.html#cb173-2" tabindex="-1"></a><span class="fu">partialPlot</span>(RF_LS, LS_train, <span class="at">x.var =</span> landCover, <span class="at">rug =</span> <span class="cn">TRUE</span>, </span>
<span id="cb173-3"><a href="local-rf.html#cb173-3" tabindex="-1"></a>            <span class="at">which.class =</span> RF_LS<span class="sc">$</span>classes[<span class="dv">2</span>],<span class="at">xlab=</span> <span class="st">&quot;Land Cover&quot;</span>,</span>
<span id="cb173-4"><a href="local-rf.html#cb173-4" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;PDP&quot;</span>)</span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/par-plot-8.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="local-feature-importance" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Local feature importance<a href="local-rf.html#local-feature-importance" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Classical machine learning algorithms like Random Forest lack spatial calibration, hindering capturing the spatial heterogeneity in the relationship between a dependent and a set of independent variables.
To account for spatial heterogeneity (i.e. non-stationarity) on the spatial patterns distribution of hazardous events modeled as function of geographical features we can use local models.
Specifically, in the present work we explore the <strong>local feature importance</strong> of geographical independent predictor variables on the spatial distribution of landslides in canton Vaud (Switzerland).</p>
<p>We introduce <strong>Geographical Random Forest</strong> (GRF), a spatial analysis method which uses a local version of RF algorithm <span class="citation">(<a href="#ref-georganos_forest_2022"><strong>georganos_forest_2022?</strong></a>)</span> .
This is achieved by fitting a sub-model for each observation in space, taking into account the neighboring observations.
The GRF can model the non-stationarity coupled with a non-linear model (RF), which, compared to liner models, tends not to overfit due to its bootstrapping nature.
In addition RF is suited for datasets with numerous predictor variables.</p>
<p>Essentially, GRF was designed to be a bridge between machine learning and geographical models, combining inferential and explanatory power.</p>
</div>
<div id="computing-lab-geographical-random-forest" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Computing lab: Geographical Random Forest<a href="local-rf.html#computing-lab-geographical-random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the computation we introduce here the method proposed by <span class="citation">Georganos and Kalogirou (<a href="#ref-Georganos_forest_2022">2022</a>)</span> and implemented in the R package <code>SpatialML</code> <span class="citation">(<a href="#ref-SpatialML">Kalogirou and Georganos 2024</a>)</span></p>
<p>The function <code>grf</code> fitting a local version of the RF algorithm, has been implemented fro regression problem, so we need to transform our binary response variable (presence==1 / absence==0) to a numeric value which can assume a range of values from zero to one.</p>
<pre><code>## &#39;data.frame&#39;:    5173 obs. of  11 variables:
##  $ distRoad : num  176.8 70.7 35.4 35.4 90.1 ...
##  $ DEM      : num  442 450 453 453 462 ...
##  $ landCover: Factor w/ 7 levels &quot;11&quot;,&quot;15&quot;,&quot;21&quot;,..: 3 1 1 1 3 1 3 3 3 3 ...
##  $ TWI      : num  8.28 8.11 8.3 8.3 8.58 ...
##  $ planCurv : num  0.000814 -0.005182 -0.001086 -0.001086 -0.000253 ...
##  $ profCurv : num  0.01217 0.0041 -0.00189 -0.00189 -0.00121 ...
##  $ slope    : num  17.6 5.38 8.8 8.8 3.36 ...
##  $ geology  : Factor w/ 10 levels &quot;1&quot;,&quot;2&quot;,&quot;7&quot;,&quot;9&quot;,..: 7 7 7 7 7 7 7 7 7 7 ...
##  $ x        : num  567850 568050 567950 567950 567850 ...
##  $ y        : num  2e+05 2e+05 2e+05 2e+05 2e+05 ...
##  $ LS       : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:15] 2598 2771 2939 2985 3237 3409 3456 3615 4058 4216 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:15] &quot;2598&quot; &quot;2771&quot; &quot;2939&quot; &quot;2985&quot; ...</code></pre>
<pre><code>## &#39;data.frame&#39;:    4138 obs. of  12 variables:
##  $ distRoad : num  25 35.4 50 0 50 ...
##  $ DEM      : num  566 549 1151 1058 579 ...
##  $ landCover: Factor w/ 7 levels &quot;11&quot;,&quot;15&quot;,&quot;21&quot;,..: 4 2 3 5 2 3 5 2 5 5 ...
##  $ TWI      : num  8.09 8.42 9.45 16.44 8.83 ...
##  $ planCurv : num  0.017138 0.001319 0.000871 -0.009321 -0.001597 ...
##  $ profCurv : num  -1.12e-02 3.92e-05 -3.13e-03 1.52e-02 4.64e-03 ...
##  $ slope    : num  5.49 15.33 13.87 5.05 10.35 ...
##  $ geology  : Factor w/ 10 levels &quot;1&quot;,&quot;2&quot;,&quot;7&quot;,&quot;9&quot;,..: 1 1 1 2 1 1 1 1 5 1 ...
##  $ x        : num  558650 536550 560850 515450 535550 ...
##  $ y        : num  145400 154500 148400 168900 156800 ...
##  $ LS       : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 1 1 2 1 2 1 2 ...
##  $ LSregr   : num  1 1 1 0 0 1 0 1 0 1 ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:15] 2598 2771 2939 2985 3237 3409 3456 3615 4058 4216 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:15] &quot;2598&quot; &quot;2771&quot; &quot;2939&quot; &quot;2985&quot; ...</code></pre>
<pre><code>## &#39;data.frame&#39;:    1035 obs. of  12 variables:
##  $ distRoad : num  79.1 111.8 35.4 35.4 25 ...
##  $ DEM      : num  484 1060 847 556 1327 ...
##  $ landCover: Factor w/ 7 levels &quot;11&quot;,&quot;15&quot;,&quot;21&quot;,..: 3 5 2 3 3 3 2 5 1 3 ...
##  $ TWI      : num  10.9 11.2 10.1 10.5 10.2 ...
##  $ planCurv : num  -0.002085 -0.000343 -0.000788 0.000117 -0.001574 ...
##  $ profCurv : num  -0.001125 0.000457 0.001293 -0.000683 -0.002214 ...
##  $ slope    : num  14.39 1.97 15.91 4.74 20.62 ...
##  $ geology  : Factor w/ 10 levels &quot;1&quot;,&quot;2&quot;,&quot;7&quot;,&quot;9&quot;,..: 7 1 7 1 1 1 1 2 7 1 ...
##  $ x        : num  529950 518550 552950 543550 572150 ...
##  $ y        : num  160700 165100 148200 174100 136000 ...
##  $ LS       : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 2 1 2 1 2 1 2 1 ...
##  $ LSregr   : num  1 0 1 0 1 0 1 0 1 0 ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:15] 2598 2771 2939 2985 3237 3409 3456 3615 4058 4216 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:15] &quot;2598&quot; &quot;2771&quot; &quot;2939&quot; &quot;2985&quot; ...</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="local-rf.html#cb177-1" tabindex="-1"></a>Coords<span class="ot">&lt;-</span>LS_train[,<span class="dv">9</span><span class="sc">:</span><span class="dv">10</span>] <span class="co"># define coordinates</span></span>
<span id="cb177-2"><a href="local-rf.html#cb177-2" tabindex="-1"></a></span>
<span id="cb177-3"><a href="local-rf.html#cb177-3" tabindex="-1"></a><span class="co"># Run GRF</span></span>
<span id="cb177-4"><a href="local-rf.html#cb177-4" tabindex="-1"></a></span>
<span id="cb177-5"><a href="local-rf.html#cb177-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># initialize </span></span>
<span id="cb177-6"><a href="local-rf.html#cb177-6" tabindex="-1"></a></span>
<span id="cb177-7"><a href="local-rf.html#cb177-7" tabindex="-1"></a>gwRF_LS<span class="ot">&lt;-</span><span class="fu">grf</span>(LSregr<span class="sc">~</span>distRoad<span class="sc">+</span>DEM<span class="sc">+</span>landCover<span class="sc">+</span>TWI<span class="sc">+</span>planCurv<span class="sc">+</span>profCurv<span class="sc">+</span>slope<span class="sc">+</span>geology,  LS_train, <span class="at">bw=</span><span class="dv">40</span>, <span class="at">mtry=</span><span class="dv">3</span>, <span class="at">kernel=</span><span class="st">&quot;adaptive&quot;</span>,<span class="at">coords=</span>Coords)</span></code></pre></div>
<pre><code>## Ranger result
## 
## Call:
##  ranger(LSregr ~ distRoad + DEM + landCover + TWI + planCurv +      profCurv + slope + geology, data = LS_train, num.trees = 500,      mtry = 3, importance = &quot;impurity&quot;, num.threads = NULL) 
## 
## Type:                             Regression 
## Number of trees:                  500 
## Sample size:                      4138 
## Number of independent variables:  8 
## Mtry:                             3 
## Target node size:                 5 
## Variable importance mode:         impurity 
## Splitrule:                        variance 
## OOB prediction error (MSE):       0.1179855 
## R squared (OOB):                  0.5281665 
##  distRoad       DEM landCover       TWI  planCurv  profCurv     slope   geology 
## 189.03796 118.23180  42.58344 112.62676  86.64094 103.52100 275.56255  45.92905 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -1.00000 -0.03989  0.00000 -0.02352  0.01996  1.00000 
##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -0.5771719 -0.0038917  0.0000000 -0.0004654  0.0030000  0.4914078 
##           Min      Max      Mean       StD
## distRoad    0 5.057082 0.6840634 0.8651427
## DEM         0 5.097790 0.8308835 0.8286699
## landCover   0 3.263085 0.2288518 0.3818137
## TWI         0 4.108891 0.6034478 0.6340272
## planCurv    0 3.295054 0.4977787 0.4819980
## profCurv    0 4.177866 0.4866789 0.5209168
## slope       0 4.749768 0.8323274 0.8537186
## geology     0 4.923056 0.2181370 0.3916300</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="local-rf.html#cb179-1" tabindex="-1"></a><span class="fu">saveRDS</span>(gwRF_LS, <span class="st">&quot;gwRF_LS.rds&quot;</span>)</span></code></pre></div>
<div id="global-variable-importance-plot" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Global variable importance plot<a href="local-rf.html#global-variable-importance-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Based on the results of the GRF, we can plot of the variable importance ranking for illustrative purposes.
Values came from “<code>Global ML Model Summary</code>” –&gt; “<code>Importance</code>”</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="local-rf.html#cb180-1" tabindex="-1"></a><span class="co"># Create a data frame with variable names and importance values</span></span>
<span id="cb180-2"><a href="local-rf.html#cb180-2" tabindex="-1"></a>variable_importance <span class="ot">&lt;-</span> <span class="fu">data.frame</span> (</span>
<span id="cb180-3"><a href="local-rf.html#cb180-3" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">c</span>(<span class="st">&quot;distRoad&quot;</span>, <span class="st">&quot;DEM&quot;</span>, <span class="st">&quot;landCover&quot;</span>, <span class="st">&quot;TWI&quot;</span>, <span class="st">&quot;planCurv&quot;</span>, <span class="st">&quot;profCurv&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;geology&quot;</span>),</span>
<span id="cb180-4"><a href="local-rf.html#cb180-4" tabindex="-1"></a>  <span class="at">Importance =</span> <span class="fu">c</span>(<span class="fl">181.18490</span>, <span class="fl">114.32444</span>,  <span class="fl">34.23643</span>, <span class="fl">101.51863</span>,  <span class="fl">84.81667</span>, <span class="fl">125.93651</span>, <span class="fl">297.74411</span>,  <span class="fl">39.22721</span> ) <span class="co"># Importance - Global ML</span></span>
<span id="cb180-5"><a href="local-rf.html#cb180-5" tabindex="-1"></a>)</span>
<span id="cb180-6"><a href="local-rf.html#cb180-6" tabindex="-1"></a></span>
<span id="cb180-7"><a href="local-rf.html#cb180-7" tabindex="-1"></a><span class="co"># Assign different colors to the top three important variables</span></span>
<span id="cb180-8"><a href="local-rf.html#cb180-8" tabindex="-1"></a>variable_importance<span class="sc">$</span>Color <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(variable_importance<span class="sc">$</span>Importance <span class="sc">&gt;=</span> <span class="fu">sort</span>(variable_importance<span class="sc">$</span>Importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">3</span>], <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;skyblue&quot;</span>)</span>
<span id="cb180-9"><a href="local-rf.html#cb180-9" tabindex="-1"></a></span>
<span id="cb180-10"><a href="local-rf.html#cb180-10" tabindex="-1"></a><span class="co"># Create a bar plot for variable importance with different colors for the top three variables</span></span>
<span id="cb180-11"><a href="local-rf.html#cb180-11" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> variable_importance, <span class="fu">aes</span>(<span class="at">x =</span> Variable, <span class="at">y =</span> Importance, <span class="at">fill =</span> Color)) <span class="sc">+</span></span>
<span id="cb180-12"><a href="local-rf.html#cb180-12" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb180-13"><a href="local-rf.html#cb180-13" tabindex="-1"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb180-14"><a href="local-rf.html#cb180-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Variable Importance Plot&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Variable&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Importance&quot;</span>) <span class="sc">+</span></span>
<span id="cb180-15"><a href="local-rf.html#cb180-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))  <span class="co"># Rotate x-axis labels for better readability</span></span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/Global-Var-Imp-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="local-feature-importance-mapping" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Local feature importance mapping<a href="local-rf.html#local-feature-importance-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can display the local feature importance scores for the two variables that are globally most important, the slope and the distance to road, with the output values mapped over the geographic space.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="local-rf.html#cb181-1" tabindex="-1"></a><span class="co"># Create a data frame with the values of the local variables importance and the coordinates for each location</span></span>
<span id="cb181-2"><a href="local-rf.html#cb181-2" tabindex="-1"></a>gwRF_LS_var<span class="ot">&lt;-</span>gwRF_LS<span class="sc">$</span>Local.Variable.Importance</span>
<span id="cb181-3"><a href="local-rf.html#cb181-3" tabindex="-1"></a>gwRF_LS_var_XY<span class="ot">&lt;-</span><span class="fu">cbind</span>(gwRF_LS_var,LS_train<span class="sc">$</span>x,LS_train<span class="sc">$</span>y ) <span class="co"># add coordinates</span></span>
<span id="cb181-4"><a href="local-rf.html#cb181-4" tabindex="-1"></a><span class="fu">colnames</span>(gwRF_LS_var_XY)[<span class="dv">9</span>]<span class="ot">&lt;-</span> <span class="st">&quot;X&quot;</span> <span class="co">#rename column X-coordinate </span></span>
<span id="cb181-5"><a href="local-rf.html#cb181-5" tabindex="-1"></a><span class="fu">colnames</span>(gwRF_LS_var_XY)[<span class="dv">10</span>]<span class="ot">&lt;-</span> <span class="st">&quot;Y&quot;</span> <span class="co">#rename column Y-coordinate </span></span>
<span id="cb181-6"><a href="local-rf.html#cb181-6" tabindex="-1"></a><span class="fu">str</span>(gwRF_LS_var_XY) </span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4138 obs. of  10 variables:
##  $ distRoad : num  0.0562 0.271 0.383 0.0165 0.2723 ...
##  $ DEM      : num  0.0427 0.8705 0.9203 0.5591 2.3373 ...
##  $ landCover: num  0.22036 0.04229 0.08014 0.00167 0.43775 ...
##  $ TWI      : num  0.1152 0.6513 0.4731 0.0766 1.3823 ...
##  $ planCurv : num  0.00755 0.59866 1.06332 0.03534 0.66228 ...
##  $ profCurv : num  0.0725 0.2454 0.8325 0.2023 0.8722 ...
##  $ slope    : num  0.00984 1.67939 1.23443 0.02137 1.13352 ...
##  $ geology  : num  0.0107 0.2399 0.3959 0.3438 1.8822 ...
##  $ X        : num  558650 536550 560850 515450 535550 ...
##  $ Y        : num  145400 154500 148400 168900 156800 ...</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="local-rf.html#cb183-1" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co">#for spatial data operations</span></span>
<span id="cb183-2"><a href="local-rf.html#cb183-2" tabindex="-1"></a><span class="co"># Convert vector to sf (simple feature)</span></span>
<span id="cb183-3"><a href="local-rf.html#cb183-3" tabindex="-1"></a>Vaud<span class="ot">&lt;-</span><span class="fu">vect</span>(<span class="st">&quot;data/RF/Vaud_CH.shp&quot;</span>)</span>
<span id="cb183-4"><a href="local-rf.html#cb183-4" tabindex="-1"></a>Vaud_sf<span class="ot">&lt;-</span><span class="fu">st_as_sf</span>(Vaud) </span>
<span id="cb183-5"><a href="local-rf.html#cb183-5" tabindex="-1"></a></span>
<span id="cb183-6"><a href="local-rf.html#cb183-6" tabindex="-1"></a><span class="co"># Output predicted values are transformed to a vector</span></span>
<span id="cb183-7"><a href="local-rf.html#cb183-7" tabindex="-1"></a>pred.vect <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(gwRF_LS_var_XY<span class="sc">$</span>slope)</span>
<span id="cb183-8"><a href="local-rf.html#cb183-8" tabindex="-1"></a></span>
<span id="cb183-9"><a href="local-rf.html#cb183-9" tabindex="-1"></a><span class="fu">library</span>(classInt) <span class="co">#for classification</span></span>
<span id="cb183-10"><a href="local-rf.html#cb183-10" tabindex="-1"></a></span>
<span id="cb183-11"><a href="local-rf.html#cb183-11" tabindex="-1"></a>brk<span class="ot">&lt;-</span>(<span class="fu">classIntervals</span>(pred.vect, <span class="at">n=</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>))</span>
<span id="cb183-12"><a href="local-rf.html#cb183-12" tabindex="-1"></a>brkInt<span class="ot">&lt;-</span><span class="fu">round</span>(brk<span class="sc">$</span>brks, <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb183-13"><a href="local-rf.html#cb183-13" tabindex="-1"></a><span class="fu">print</span>(brkInt)</span></code></pre></div>
<pre><code>## [1] 0.00 0.41 0.99 1.61 2.47 4.75</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="local-rf.html#cb185-1" tabindex="-1"></a><span class="co">#natural breaks (fisher)</span></span>
<span id="cb185-2"><a href="local-rf.html#cb185-2" tabindex="-1"></a></span>
<span id="cb185-3"><a href="local-rf.html#cb185-3" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb185-4"><a href="local-rf.html#cb185-4" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> gwRF_LS_var_XY, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">colour =</span> slope), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb185-5"><a href="local-rf.html#cb185-5" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;orange&quot;</span>,<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),  </span>
<span id="cb185-6"><a href="local-rf.html#cb185-6" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">0.40</span>, <span class="fl">1.15</span>, <span class="fl">2.11</span>, <span class="fl">3.23</span>, <span class="fl">4.91</span>), </span>
<span id="cb185-7"><a href="local-rf.html#cb185-7" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">0.40</span>, <span class="fl">1.15</span>, <span class="fl">2.11</span>, <span class="fl">3.23</span>, <span class="fl">4.91</span>)) <span class="sc">+</span></span>
<span id="cb185-8"><a href="local-rf.html#cb185-8" tabindex="-1"></a>        <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;X Coordinate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Y Coordinate&quot;</span>)<span class="sc">+</span></span>
<span id="cb185-9"><a href="local-rf.html#cb185-9" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Local average FI - Slope&quot;</span>)<span class="sc">+</span></span>
<span id="cb185-10"><a href="local-rf.html#cb185-10" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> Vaud_sf, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="co">#overlap borders</span></span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/Slope_Imp-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="local-rf.html#cb186-1" tabindex="-1"></a><span class="co"># Output predicted values are transformed to a vector</span></span>
<span id="cb186-2"><a href="local-rf.html#cb186-2" tabindex="-1"></a>pred.vect <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(gwRF_LS<span class="sc">$</span>Local.Variable.Importance<span class="sc">$</span>distRoad)</span>
<span id="cb186-3"><a href="local-rf.html#cb186-3" tabindex="-1"></a> </span>
<span id="cb186-4"><a href="local-rf.html#cb186-4" tabindex="-1"></a>brk<span class="ot">&lt;-</span>(<span class="fu">classIntervals</span>(pred.vect, <span class="at">n=</span><span class="dv">5</span>, <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>))</span>
<span id="cb186-5"><a href="local-rf.html#cb186-5" tabindex="-1"></a>brkInt<span class="ot">&lt;-</span><span class="fu">round</span>(brk<span class="sc">$</span>brks, <span class="at">digits=</span><span class="dv">2</span>)</span>
<span id="cb186-6"><a href="local-rf.html#cb186-6" tabindex="-1"></a><span class="fu">print</span>(brkInt) <span class="co"># print breaks</span></span></code></pre></div>
<pre><code>## [1] 0.00 0.39 1.06 2.08 3.48 5.06</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="local-rf.html#cb188-1" tabindex="-1"></a><span class="co">#natural breaks (fisher)</span></span>
<span id="cb188-2"><a href="local-rf.html#cb188-2" tabindex="-1"></a></span>
<span id="cb188-3"><a href="local-rf.html#cb188-3" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb188-4"><a href="local-rf.html#cb188-4" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> gwRF_LS_var_XY, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">colour =</span> distRoad), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb188-5"><a href="local-rf.html#cb188-5" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;orange&quot;</span>,<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), </span>
<span id="cb188-6"><a href="local-rf.html#cb188-6" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">0.37</span>, <span class="fl">1.02</span>, <span class="fl">2.17</span>, <span class="fl">3.58</span>, <span class="fl">4.85</span>), </span>
<span id="cb188-7"><a href="local-rf.html#cb188-7" tabindex="-1"></a>                       <span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.00</span>, <span class="fl">0.37</span>, <span class="fl">1.02</span>, <span class="fl">2.17</span>, <span class="fl">3.58</span>, <span class="fl">4.85</span>)) <span class="sc">+</span></span>
<span id="cb188-8"><a href="local-rf.html#cb188-8" tabindex="-1"></a>    <span class="fu">labs</span>( <span class="at">x =</span> <span class="st">&quot;X Coordinate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Y Coordinate&quot;</span>)<span class="sc">+</span></span>
<span id="cb188-9"><a href="local-rf.html#cb188-9" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Local average FI - Distance to roads&quot;</span>)<span class="sc">+</span></span>
<span id="cb188-10"><a href="local-rf.html#cb188-10" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> Vaud_sf, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="co">#overlap borders</span></span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/distRoad-Imp-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="local-r-squared" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Local R squared<a href="local-rf.html#local-r-squared" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Local R-squared value represents the strength of the correlations of the local model on the predictor variables and ranges from 0 to 1.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="local-rf.html#cb189-1" tabindex="-1"></a>Rsq<span class="ot">&lt;-</span>gwRF_LS<span class="sc">$</span>LGofFit<span class="sc">$</span>LM_Rsq100</span>
<span id="cb189-2"><a href="local-rf.html#cb189-2" tabindex="-1"></a>Rsq_XY<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Rsq,LS_train<span class="sc">$</span>x,LS_train<span class="sc">$</span>y)) <span class="co"># add coordinates</span></span>
<span id="cb189-3"><a href="local-rf.html#cb189-3" tabindex="-1"></a><span class="fu">colnames</span>(Rsq_XY)[<span class="dv">2</span>]<span class="ot">&lt;-</span> <span class="st">&quot;X&quot;</span></span>
<span id="cb189-4"><a href="local-rf.html#cb189-4" tabindex="-1"></a><span class="fu">colnames</span>(Rsq_XY)[<span class="dv">3</span>]<span class="ot">&lt;-</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb189-5"><a href="local-rf.html#cb189-5" tabindex="-1"></a><span class="fu">str</span>(Rsq_XY)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4138 obs. of  3 variables:
##  $ Rsq: num  -0.258 0.537 -0.144 -0.255 0.322 ...
##  $ X  : num  558650 536550 560850 515450 535550 ...
##  $ Y  : num  145400 154500 148400 168900 156800 ...</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="local-rf.html#cb191-1" tabindex="-1"></a><span class="fu">ggplot</span> () <span class="sc">+</span></span>
<span id="cb191-2"><a href="local-rf.html#cb191-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Rsq_XY, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">colour =</span> Rsq), <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span> </span>
<span id="cb191-3"><a href="local-rf.html#cb191-3" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))<span class="sc">+</span></span>
<span id="cb191-4"><a href="local-rf.html#cb191-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Rsq&quot;</span>, <span class="at">x =</span> <span class="st">&quot;X Coordinate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Y Coordinate&quot;</span>)<span class="sc">+</span></span>
<span id="cb191-5"><a href="local-rf.html#cb191-5" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Local R2&quot;</span>)<span class="sc">+</span></span>
<span id="cb191-6"><a href="local-rf.html#cb191-6" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> Vaud_sf, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">2</span>) <span class="co">#overlap borders</span></span></code></pre></div>
<p><img src="06-Exp_RF_files/figure-html/local-R2-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="conclusions-and-further-analyses-3" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Conclusions and further analyses<a href="local-rf.html#conclusions-and-further-analyses-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the present exercise GRF has been used as a purely exploratory tool to estimate the spatial variation of the relationship between landslides in Canton Vaud (Switzerland) and the predictor variables.
It allowed to elaborate maps based on the local average importance of the most highly correlated features and to visualize the local fitting performance (R2 local value) into a map.</p>
<p>To ensure that everything is perfectly clear, we propose you to answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>Among the following algorithms evaluate them in therms of their interpretability and explainability: Support Vector Machines , linear regression, Deep Learning Models, Decision Trees, K-Nearest Neighbors, Neural Networks, Random Forests, logistic regression.</p></li>
<li><p>Which are the three most important variables of your model (based on the MDA)?</p></li>
<li><p>What is the slope value (or range of values) that gives the highest probability of landslides occurrence?
And for the geology, which are the most important classes?</p></li>
<li><p>Evaluate the spatial variation of the relationship between landslides and slope / distance to roads in your study area by visually inspecting the local average importance of these features.</p></li>
<li><p>You can replicate this code (some chiuncks of it) to evaluate the local average importance of the third most important variable, as well as to map the local mean squared error.</p></li>
</ol>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Georganos_forest_2022" class="csl-entry">
Georganos, Stefanos, and Stamatis Kalogirou. 2022. <span>“A Forest of Forests: A Spatially Weighted and Computationally Efficient Formulation of Geographical Random Forests”</span> 11 (9). MDPI AG: 471. doi:<a href="https://doi.org/10.3390/ijgi11090471">10.3390/ijgi11090471</a>.
</div>
<div id="ref-SpatialML" class="csl-entry">
Kalogirou, Stamatis, and Stefanos Georganos. 2024. <em>SpatialML: Spatial Machine Learning</em>. <a href="https://CRAN.R-project.org/package=SpatialML">https://CRAN.R-project.org/package=SpatialML</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="global-rf.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="som.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/EugeneGIS/AGDAbook/edit/master/06-Exp_RF.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["fake-book.pdf", "fake-book.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 2
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
